<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Resume</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- 引入组件库 -->

</head>
<body>

    <div id="app">
        <div class="App">
            <div class="Container">
                <div class="SideBar">
                    <div class="SideMenu">
                        <div class="Active">
                            <a href="#" >编辑</a>
                        </div>
                        <div>
                            <a href="#" @click="genMarkerdownFile" >下载</a>
                        </div>
                        <div>
                            <a href="#" @click="genPdfFile">PDF</a>
                        </div>
                        <div>
                            <a href="https://github.com/hehear/resume">源码</a>
                        </div>
                    </div>
                </div>
                <div class="SectionBar">
                    <div class="Editor Active">
                        Resume Editor
                    </div>
                    <div class="Spacer">
                        点击插入内容
                    </div>
                    <ul class="GuideList">
                        <li><a href="#" @click="insertContactInfo">
                            <svg fill="currentColor" preserveaspectratio="xMidYMid meet" height="1em" width="1em" viewbox="0 0 40 40" style="vertical-align: middle;">
                                <g>
                                    <path d="m33.4 13.4v-3.4l-13.4 8.4-13.4-8.4v3.4l13.4 8.2z m0-6.8q1.3 0 2.3 1.1t0.9 2.3v20q0 1.3-0.9 2.3t-2.3 1.1h-26.8q-1.3 0-2.3-1.1t-0.9-2.3v-20q0-1.3 0.9-2.3t2.3-1.1h26.8z"></path>
                                </g>
                            </svg>联系方式</a></li>
                        <li><a href="#" @click="insertPersonalInfo">
                            <svg fill="currentColor" preserveaspectratio="xMidYMid meet" height="1em" width="1em" viewbox="0 0 40 40" style="vertical-align: middle;">
                                <g>
                                    <path d="m20 29.1q-2.9 0-5.2-1.6t-3.3-4.1h17q-1 2.5-3.3 4.1t-5.2 1.6z m-5.9-10.7q-1 0-1.7-0.8t-0.8-1.7 0.8-1.8 1.7-0.7 1.8 0.7 0.7 1.8-0.7 1.7-1.8 0.8z m11.8 0q-1.1 0-1.8-0.8t-0.7-1.7 0.7-1.8 1.8-0.7 1.7 0.7 0.8 1.8-0.8 1.7-1.7 0.8z m-5.9 15q5.5 0 9.4-4t4-9.4-4-9.4-9.4-4-9.4 4-4 9.4 4 9.4 9.4 4z m0-30q6.9 0 11.8 4.8t4.8 11.8-4.8 11.8-11.8 4.8-11.8-4.8-4.8-11.8 4.8-11.8 11.8-4.8z"></path>
                                </g>
                            </svg>个人信息</a></li>
                        <li><a href="#" @click="insertExperience">
                            <svg fill="currentColor" preserveaspectratio="xMidYMid meet" height="1em" width="1em" viewbox="0 0 40 40" style="vertical-align: middle;">
                                <g>
                                    <path d="m23.4 11.6v-3.2h-6.8v3.2h6.8z m10 0c1.8 0 3.2 1.6 3.2 3.4v5c0 1.8-1.4 3.4-3.2 3.4h-10v-3.4h-6.8v3.4h-10c-1.8 0-3.2-1.5-3.2-3.4v-5c0-1.8 1.4-3.4 3.2-3.4h6.7v-3.2l3.3-3.4h6.7l3.3 3.4v3.2h6.8z m-16.8 15h6.8v-1.6h11.6v6.6c0 1.9-1.5 3.4-3.4 3.4h-23.2c-1.9 0-3.4-1.5-3.4-3.4v-6.6h11.6v1.6z"></path>
                                </g>
                            </svg>经历证明</a></li>
                        <li><a href="#" @click="insertAbility">
                            <svg fill="currentColor" preserveaspectratio="xMidYMid meet" height="1em" width="1em" viewbox="0 0 40 40" style="vertical-align: middle;">
                                <g>
                                    <path d="m23.4 9.1c0-2.2 1.8-4.1 4.1-4.1s4.1 1.9 4.1 4.1-1.8 4.3-4.1 4.3-4.1-2-4.1-4.3z m-8.9 10.9c-1 0-1.4-0.2-2-0.6-0.3-0.3-0.7-0.4-1.2-0.6l5.3-5.4-1.6-1.8c-1.9-1.8-3.6-2.5-6.6-2.5v-4.1c4.1 0 6.5 0.8 9.1 3.4l10.7 10.6c-0.2 0.1-0.5 0.3-0.7 0.4-0.6 0.4-1 0.6-2 0.6s-1.2-0.2-1.8-0.6c-0.8-0.5-1.8-1-3.7-1s-2.9 0.5-3.7 1c-0.6 0.4-0.9 0.6-1.8 0.6z m22.1 7.5c-1.8 0-2.8-0.6-3.6-1.1-0.6-0.4-1-0.5-1.9-0.5s-1.3 0.1-1.9 0.5c-0.8 0.5-1.8 1.1-3.7 1.1s-2.8-0.6-3.5-1.1c-0.7-0.4-1.1-0.5-2-0.5s-1.2 0.1-1.9 0.5c-0.8 0.5-1.8 1.1-3.6 1.1s-2.9-0.6-3.6-1.1c-0.7-0.4-1.1-0.5-2-0.5s-1.2 0.1-1.9 0.5c-0.8 0.5-1.8 1.1-3.6 1.1v-3.4c0.9 0 1.2-0.1 1.8-0.5 0.8-0.5 1.8-1.1 3.7-1.1s2.8 0.6 3.6 1.1c0.6 0.4 1 0.5 2 0.5s1.2-0.1 1.8-0.5c0.8-0.5 1.8-1.1 3.7-1.1s2.8 0.6 3.6 1.1c0.6 0.4 1 0.5 1.9 0.5s1.3-0.1 1.9-0.5c0.8-0.5 1.8-1.1 3.7-1.1s2.8 0.6 3.6 1.1c0.6 0.4 1 0.5 1.9 0.5v3.4z m0 7.5c-1.8 0-2.8-0.6-3.6-1.1-0.6-0.4-1-0.5-1.9-0.5s-1.3 0.1-1.9 0.5c-0.8 0.5-1.8 1.1-3.7 1.1s-2.8-0.6-3.5-1.1c-0.7-0.4-1.1-0.5-2-0.5s-1.2 0.1-1.9 0.5c-0.8 0.5-1.8 1.1-3.6 1.1s-2.9-0.6-3.7-1.1c-0.6-0.4-1-0.5-1.9-0.5s-1.3 0.1-1.9 0.5c-0.8 0.5-1.8 1.1-3.6 1.1v-3.4c0.9 0 1.2-0.1 1.8-0.5 0.8-0.5 1.8-1.1 3.7-1.1s2.8 0.6 3.6 1.1c0.6 0.4 1 0.5 2 0.5s1.2-0.1 1.8-0.5c0.8-0.5 1.8-1.1 3.7-1.1s2.9 0.6 3.7 1.1c0.6 0.4 0.9 0.5 1.8 0.5s1.4-0.1 2-0.5c0.8-0.5 1.7-1.1 3.6-1.1s2.9 0.6 3.7 1.1c0.6 0.4 0.9 0.5 1.8 0.5v3.4z"></path>
                                </g>
                            </svg>能力证明</a></li>
                        <li><a href="#" @click="insertSkillList">
                            <svg fill="currentColor" preserveaspectratio="xMidYMid meet" height="1em" width="1em" viewbox="0 0 40 40" style="vertical-align: middle;">
                                <g>
                                    <path d="m11.6 11.6h23.4v3.4h-23.4v-3.4z m0 16.8v-3.4h23.4v3.4h-23.4z m0-6.8v-3.2h23.4v3.2h-23.4z m-6.6-6.6v-3.4h3.4v3.4h-3.4z m0 13.4v-3.4h3.4v3.4h-3.4z m0-6.8v-3.2h3.4v3.2h-3.4z"></path>
                                </g>
                            </svg>技能清单</a></li>
                        <li><a href="#" @click="insertThanksInfo">
                            <svg fill="currentColor" preserveaspectratio="xMidYMid meet" height="1em" width="1em" viewbox="0 0 40 40" style="vertical-align: middle;">
                                <g>
                                    <path d="m25.8 16c-2.1 1.2-4.1 2.7-5.8 4.5-1.7-1.8-3.7-3.3-5.8-4.5 0.4-4.6 2.3-9.1 5.9-12.6 3.5 3.5 5.4 7.9 5.7 12.6z m-22.4 0.6c7.4 0 13.4 4.3 16.6 9.2 3.2-4.9 9.2-9.2 16.6-9.2 0 8.9-5.5 16.4-13.3 19.2-1.1 0.4-2.1 0.6-3.3 0.8-1.2-0.1-2.3-0.4-3.3-0.8-7.8-2.8-13.3-10.3-13.3-19.2z"></path>
                                </g>
                            </svg>致谢</a></li>
                    </ul>
                </div>
                <div class="WorkingBox">
                    <div id="MdEditor" style="box-sizing: border-box; height: 100%;">
                        <iframe :src="editormd_html" ref="iframe" style="width: 100%; height: 100%; margin:0; padding:0; position: relative;"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/jquery-1.7.2.min.js" type='text/javascript'></script>
    <script src="/md/js/editormd.js" type="text/javascript" ></script>
    <script src="/md/lib/marked.min.js" type="text/javascript" ></script>
    <script src="/md/lib/prettify.min.js" type="text/javascript" ></script>
    <script src='/js/vue.min.js' type='text/javascript'></script>
    <script>
    var isLoaded=false;

    var vm = new Vue({

        el : '#app',
        data : {
            contentMarkdown:'',
            htmlContent:'',
            message:'',
            editormd_html:"/md/html/editormd.html",
            addEditor:{},
            isLoaded:false,
            iframeWin: {}
        },
        // 在外部vue的window上添加postMessage的监听，并且绑定处理函数handleMessage
        mounted:function() {

            //window.removeEventListener('message', this.handleMessage);
            window.addEventListener('message', this.handleMessage);
            this.iframeWin = this.$refs.iframe.contentWindow;
        },

        methods:{

            //插入联系信息
            insertContactInfo : function(){

                vm.message='addMessage';
                vm.contentMarkdown='\n'+'\n'+'# 联系方式\n' +
                    '\n' +
                    '（HR会打印你的简历，用于在面试的时候联系，所以联系方式放到最上边会比较方便）\n' +
                    '\n' +
                    '- 手机：135.... （如果是外地手机，可注明。如经常关机，要写上最优联系时间）\n' +
                    '- Email：goodman@gmail.com （虽然我觉得QQ邮箱无所谓，不过有些技术人员比较反感，建议用G，非要用的话，不要用数字邮箱名）\n' +
                    '- QQ/微信号：6...（提供一个通过网络可以联系到你的方式）';
                vm.sendMessage();
            },
            //插入个人信息
            insertPersonalInfo : function(){

                vm.message='addMessage';
                vm.contentMarkdown='\n'+'\n'+'# 个人信息\n' +
                    '\n' +
                    ' - 冷熊/男/1990 \n' +
                    ' - 本科/北极大学计算机系 \n' +
                    ' - 工作年限：3年\n' +
                    ' - 微博：[@Easy](http://weibo.com/easy) （如果没有技术相关内容，也可以不放）\n' +
                    ' - 技术博客：http://old.ftqq.com ( 使用GitHub Host的Big较高  )\n' +
                    ' - Github：http://github.com/easychen ( 有原创repo的Github帐号会极大的提升你的个人品牌  )\n' +
                    '\n' +
                    ' - 期望职位：PHP高级程序员，应用架构师\n' +
                    ' - 期望薪资：税前月薪15k~20k，特别喜欢的公司可例外\n' +
                    ' - 期望城市：北京';
                vm.sendMessage();
            },
            //插入经历证明
            insertExperience : function(){

                vm.message='addMessage';
                vm.contentMarkdown='\n'+'\n'+'# 工作经历\n' +
                    '（工作经历按逆序排列，最新的在最前边，按公司做一级分组，公司内按二级分组）\n' +
                    '\n' +
                    '## ABC公司 （ 2012年9月 ~ 2014年9月 ）\n' +
                    '\n' +
                    '### DEF项目 \n' +
                    '我在此项目负责了哪些工作，分别在哪些地方做得出色/和别人不一样/成长快，这个项目中，我最困难的问题是什么，我采取了什么措施，最后结果如何。这个项目中，我最自豪的技术细节是什么，为什么，实施前和实施后的数据对比如何，同事和领导对此的反应如何。\n' +
                    '\n' +
                    '\n' +
                    '### GHI项目 \n' +
                    '我在此项目负责了哪些工作，分别在哪些地方做得出色/和别人不一样/成长快，这个项目中，我最困难的问题是什么，我采取了什么措施，最后结果如何。这个项目中，我最自豪的技术细节是什么，为什么，实施前和实施后的数据对比如何，同事和领导对此的反应如何。\n' +
                    '\n' +
                    '\n' +
                    '### 其他项目\n' +
                    '\n' +
                    '（每个公司写2~3个核心项目就好了，如果你有非常大量的项目，那么按分类进行合并，每一类选一个典型写出来。其他的一笔带过即可。）\n' +
                    '\n' +
                    '  \n' +
                    '## JKL公司 （ 2010年3月 ~ 2012年8月 ）\n' +
                    '\n' +
                    '### MNO项目 \n' +
                    '我在此项目负责了哪些工作，分别在哪些地方做得出色/和别人不一样/成长快，这个项目中，我最困难的问题是什么，我采取了什么措施，最后结果如何。这个项目中，我最自豪的技术细节是什么，为什么，实施前和实施后的数据对比如何，同事和领导对此的反应如何。\n' +
                    '\n' +
                    '\n' +
                    '### PQR项目 \n' +
                    '我在此项目负责了哪些工作，分别在哪些地方做得出色/和别人不一样/成长快，这个项目中，我最困难的问题是什么，我采取了什么措施，最后结果如何。这个项目中，我最自豪的技术细节是什么，为什么，实施前和实施后的数据对比如何，同事和领导对此的反应如何。\n' +
                    '\n' +
                    '\n' +
                    '### 其他项目\n' +
                    '\n' +
                    '（每个公司写2~3个核心项目就好了，如果你有非常大量的项目，那么按分类进行合并，每一类选一个典型写出来。其他的一笔带过即可。）';
                vm.sendMessage();
            },
            //插入能力证明
            insertAbility : function(){

                vm.message='addMessage';
                vm.contentMarkdown='\n'+'\n'+'# 开源项目和作品\n' +
                    '（这一段用于放置工作以外的、可证明你的能力的材料）\n' +
                    '\n' +
                    '## 开源项目\n' +
                    '（对于程序员来讲，没有什么比Show me the code能有说服力了）\n' +
                    '\n' +
                    '  - [STU](http://github.com/yourname/projectname)：项目的简要说明，Star和Fork数多的可以注明\n' +
                    '  - [WXYZ](http://github.com/yourname/projectname)：项目的简要说明，Star和Fork数多的可以注明\n' +
                    '\n' +
                    '## 技术文章\n' +
                    '（挑选你写作或翻译的技术文章，好的文章可以从侧面证实你的表达和沟通能力，也帮助招聘方更了解你）\n' +
                    '\n' +
                    '- [一个产品经理眼中的云计算：前生今世和未来](http://get.jobdeer.com/706.get)\n' +
                    '- [来自HeroKu的HTTP API 设计指南(翻译文章)](http://get.jobdeer.com/343.get) （ 好的翻译文章可以侧证你对英文技术文档的阅读能力）\n' +
                    '\n' +
                    '## 演讲和讲义\n' +
                    '（放置你代表公司在一些技术会议上做过的演讲，以及你在公司分享时制作的讲义）\n' +
                    '\n' +
                    '  - 2014架构师大会演讲：[如何通过Docker优化内部开发](http://ftqq.com)\n' +
                    '  - 9月公司内部分享：[云计算的前生今世](http://ftqq.com)';
                vm.sendMessage();
            },
            //插入技能列表
            insertSkillList : function(){

                vm.message='addMessage';
                vm.contentMarkdown='\n'+'\n'+'# 技能清单\n' +
                    '（我一般主张将技能清单写入到工作经历里边去。不过很难完整，所以有这么一段也不错）\n' +
                    '\n' +
                    '以下均为我熟练使用的技能\n' +
                    '\n' +
                    '- Web开发：PHP/Hack/Node\n' +
                    '- Web框架：ThinkPHP/Yaf/Yii/Lavarel/LazyPHP\n' +
                    '- 前端框架：Bootstrap/AngularJS/EmberJS/HTML5/Cocos2dJS/ionic\n' +
                    '- 前端工具：Bower/Gulp/SaSS/LeSS/PhoneGap\n' +
                    '- 数据库相关：MySQL/PgSQL/PDO/SQLite\n' +
                    '- 版本管理、文档和自动化部署工具：Svn/Git/PHPDoc/Phing/Composer\n' +
                    '- 单元测试：PHPUnit/SimpleTest/Qunit\n' +
                    '- 云和开放平台：SAE/BAE/AWS/微博开放平台/微信应用开发';
                vm.sendMessage();
            },
            //插入致谢
            insertThanksInfo : function(){

                vm.message='addMessage';
                vm.contentMarkdown='\n'+'\n'+'---      \n' +
                    '# 致谢\n' +
                    '感谢您花时间阅读我的简历，期待能有机会和您共事。';
                vm.sendMessage();
            },

            //生成markerdown
            genMarkerdownFile : function(){

                //下载markdown文件
                //var url = "http://api.hehear.com/downLoadMdFile";
                var url = "http://localhost:8080/downLoadMdFile";

                var form = $("<form></form>").attr("action",url).attr("method","post");
                form.append($("<input/>").attr("type","hidden").attr("name","mdContent").attr("value",vm.contentMarkdown));
                form.appendTo('body').submit().remove();

            },

            //生成pdf
            genPdfFile : function(){

                //拼接html内容
                var htmlContent = "<!DOCTYPE html><html lang=\"zh\"><head>" +
                    "<style type=\"text/css\">@page {size:210mm;margin:0.25min} " +
                    "body{font-family:SimSun;word-wrap: break-word;word-break: break-all}</style>" +
                    "</head><body>"
                    +vm.htmlContent
                    +"</body></html>";

                //生成pdf
                $.ajax({
                    //url:'http://api.hehear.com/genPdfByHtmlContent',
                    url:'http://localhost:8080/genPdfByHtmlContent',
                    async:false,
                    type: 'post',
                    data: {'htmlContent':htmlContent},
                    success: function (result) {

                        //下载
                        //var url = "http://api.hehear.com/downLoadPdfFile";
                        var url = "http://localhost:8080/downLoadPdfFile";
                        var form = $("<form></form>").attr("action",url).attr("method","post");
                        form.append($("<input/>").attr("type","hidden").attr("name","pdfPath").attr("value",result.record));
                        form.appendTo('body').submit().remove();
                    }
                });
            },

            //外部vue向iframe内部传数据
            sendMessage : function() {

                this.iframeWin.postMessage({
                    cmd: vm.message,
                    params: {
                        markdown:vm.contentMarkdown,
                    }
                }, '*');

            },
            //处理iframe返回的数据
            handleMessage:function async(event){

                // if(vm.isLoaded){
                //     return;
                // }

                var data = event.data;

                if (data.params.success) {

                    // 根据上面制定的结构来解析iframe内部发回来的数据
                    if("returnPdfMessage"==data.cmd){
                        // 业务逻辑
                        vm.htmlContent = data.params.html;
                        vm.contentMarkdown = data.params.markdown;

                    }
                    //vm.isLoaded = true;
                }
            }
        }
    });

    </script>

</body>
</html>